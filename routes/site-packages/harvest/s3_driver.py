import boto3

class S3Driver():

  def __init__(self, bucket_name=None):
    if not bucket_name:
      raise ValueError

    try:
      #self.__s3 = boto3.resource(service_name='s3', endpoint_url='http://127.0.0.1:9000')
      self.__s3 = boto3.resource(service_name='s3', endpoint_url='http://10.0.2.15:9000')
      if bucket_name:
        self.set_bucket(bucket_name)
    except Exception as e:
      raise e

  def get_bucket_list(self):
    return [bucket.name for bucket in self.__s3.buckets.all()]
    
  def set_bucket(self, bucket_name):
    self.__bucket = self.__s3.Bucket(bucket_name)

  def get_obj(self, obj_key):
    return self.__bucket.Object(obj_key)

  def get_obj_bytes(self, obj_key):
    obj = self.get_obj(obj_key)
    return obj.get()['Bofy'].read()

  def put_obj(self, key, data):
    if isinstance(data, bytes):
      return self.__bucket.put_object(
          Key=key, 
          Body=data
      )
