import logging
import boto3

class CognitoDriver():

  logger = logging.getLogger(__name__)
  logger.addHandler(logging.NullHandler())
  logger.setLevel(logging.DEBUG)

  def __init__(self, pool_id=None):
    self.cognito = boto3.client('cognito-idp')
    if pool_id:
      self.pool_id = pool_id

  def __list_users(self, attr, filter_attr="username", page_token=None):
    if page_token:
      return self.cognito.list_users(
        UserPoolId=self.pool_id,
        Filter='%s = "%s"' % (filter_attr, attr),
        PaginationToken=page_token
      )
    else:
      return self.cognito.list_users(
        UserPoolId=self.pool_id,
        Filter='%s = "%s"' % (filter_attr, attr)
      )
    
  def list_users(self, attr, filter_attr="username"):
    if not self.pool_id:
      raise ValueError

    ret = []
    page_token = None
    for i in range(100):
      users = __list_users(attr, filter_attr, page_token)
      print(users)
      if "PaginationToken" in users["PaginationToken"]:
        break
      ret.extend(users["Users"])

    return ret

  def show_user(self, username):
    return self.cognito.list_users(
      UserPoolId=self.pool_id,
      Filter='username = "{}"'.format(username)
    )["Users"]

#https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/cognito-idp.html#CognitoIdentityProvider.Client.list_users
