import os, sys
import json
from uuid import uuid4
from datetime import datetime
from decode_verify_jwt import decode_verify_jwt

from harvest.controllers.project_controller import ProjectController
from harvest.auth import Auth
from harvest.exception import ActionDeniedError

class Project():
  project_id = None

  def __init__(self, host=None, port=None):
    self.project = ProjectController(host, port)
    self.auth = Auth(host, port)

  # common setters
  def set_user_id(self, user_id):
    self.project.set_user_id(user_id)
    self.auth.set_user_id(user_id)

  def set_project_id(self, project_id):
    self.project_id = project_id
    self.project.set_project_id(project_id)
    self.auth.set_project_id(project_id)

  # actions for project
  def create_project(self, name, start_on, complete_on):
    return self.project.create(name, start_on, complete_on)

  def update_project(self, name):
    if not self.auth.guard("owner"):
      raise ActionDeniedError()
    return self.project.update_name(name)

  def delete_project(self):
    if not self.auth.guard("owner"):
      raise ActionDeniedError()
    return self.project.delete()

  def show_project(self):
    if not self.auth.guard():
      raise ActionDeniedError()
    return self.project.show()

  def list_projects(self):
    return self.project.list_projects()
