import os, sys
import json
from uuid import uuid4
from datetime import datetime
from decode_verify_jwt import decode_verify_jwt

from harvest.controllers.project_user_controller import ProjectUserController
from harvest.auth import Auth
from harvest.exception import ActionDeniedError

class ProjectUser():
  project_id = None

  def __init__(self, host=None, port=None):
    self.project = ProjectUserController(host, port)
    self.auth = Auth(host, port)

  # common setters
  def set_user_id(self, user_id):
    self.project.set_user_id(user_id)
    self.auth.set_user_id(user_id)

  def set_project_id(self, project_id):
    self.project_id = project_id
    self.project.set_project_id(project_id)
    self.auth.set_project_id(project_id)

  # actions for project user
  def list_users(self):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.list_users()

  def show_user(self, user_id):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.show_user(user_id)

  def join_user(self):
    return self.project.join_user()

  def accept_user(self, user_id):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.accept_user(user_id)

  def delete_user(self, user_id):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.delete_user(user_id)

  def reject_user(self, user_id):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.reject_user(user_id)

  def update_role(self, role, user_id):
    if not self.auth.guard("admin"):
      raise ActionDeniedError()
    return self.project.update_role(role, user_id)

