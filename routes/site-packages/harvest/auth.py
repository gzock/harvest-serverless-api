from harvest.controllers.role_controller import RoleController

class Auth():
  __user_id = ""
  __project_id = ""
  my_role = ""
  __roles = ["guest", "reporter", "worker", "admin", "owner"]

  def __init__(self, host, port, user_id=None, project_id=None):
    self.__role = RoleController(host, port)
    if user_id:
      self.set_user_id(user_id)
    if project_id:
      self.set_project_id(project_id)
    self.get_role()

  def set_user_id(self, user_id):
    self.__user_id = str(user_id)
    self.__role.set_user_id(str(user_id))
    self.get_role()

  def set_project_id(self, project_id):
    self.__project_id = str(project_id)
    self.__role.set_project_id(str(project_id))
    self.get_role()

  def get_role(self):
    if self.__user_id and self.__project_id:
      if not self.my_role:
        ret = self.__role.show()
        if ret and self.is_active(ret):
          self.my_role = ret["role"]
      return self.my_role

  def guard(self, role=None):
    if not self.my_role:
      return False

    if role:
      if self.__roles.index(role) > self.__roles.index(self.my_role):
        return False

    return True

  def is_active(self, role):
    if not "status" in role:
      return True

    if role["status"] == "active":
      return True

    return False
